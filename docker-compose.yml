services:
  agent-memory:
    build:
      context: .
      dockerfile: Dockerfile
    image: agent-memory:latest
    container_name: agent-memory
    volumes:
      # Bind mount to shared data directory
      # Override AGENT_MEMORY_DATA_DIR to use a different host location
      - ${AGENT_MEMORY_DATA_DIR:-~/.agent-memory}:/data
    # Load environment variables from .env file (for non-path settings)
    env_file:
      - .env
    environment:
      # Container paths are hardcoded - do not read from .env
      # The bind mount maps host's ~/.agent-memory to container's /data
      - AGENT_MEMORY_DB_PATH=/data/memory.db
      - AGENT_MEMORY_VECTOR_DB_PATH=/data/vectors.lance
      # Logging (can be overridden in .env)
      - LOG_LEVEL=${LOG_LEVEL:-info}
      - AGENT_MEMORY_PERF=${AGENT_MEMORY_PERF:-0}

      # MCP uses stdio - keep stdin open and allocate TTY
    stdin_open: true
    tty: true

    # Restart policy
    restart: unless-stopped

    # Logging configuration
    logging:
      driver: 'json-file'
      options:
        max-size: '10m'
        max-file: '3'

    # Labels for organization
    labels:
      - 'com.agent-memory.version=0.9.0'
      - 'com.agent-memory.environment=production'

    # Optional: Resource limits
    # deploy:
    #   resources:
    #     limits:
    #       cpus: '2'
    #       memory: 2G
    #     reservations:
    #       cpus: '1'
    #       memory: 512M

# Named volume (optional - only needed if not using shared bind mount)
# Uncomment to use isolated Docker volume instead of shared directory
# volumes:
#   agent-memory-data:
#     driver: local
